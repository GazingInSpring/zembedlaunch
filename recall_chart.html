<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recall@K</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',system-ui,sans-serif;background:#fafafa;-webkit-font-smoothing:antialiased;padding:40px 20px}
.container{max-width:920px;margin:0 auto;background:#fff;border-radius:16px;border:1px solid #e5e5e5;box-shadow:0 4px 24px rgba(0,0,0,.06);padding:32px 40px}

.header{margin-bottom:20px;min-height:56px;position:relative}
.title-abs,.title-delta{transition:opacity .3s,transform .3s;position:absolute;top:0;left:0;right:0}
.title-abs.hidden,.title-delta.hidden{opacity:0;pointer-events:none;transform:translateY(-4px)}
.title-abs:not(.hidden),.title-delta:not(.hidden){opacity:1;transform:translateY(0)}

h2{font-size:20px;font-weight:700;letter-spacing:-.02em;margin-bottom:3px;color:#111}
.subtitle{font-size:13px;color:#999;line-height:1.5}

.delta-title{font-size:20px;font-weight:700;letter-spacing:-.02em;margin-bottom:3px;color:#111}
.word-rotator{display:inline-block;height:1.3em;overflow:hidden;vertical-align:bottom;position:relative;min-width:70px;text-align:center}
.word-rotator .word{display:block;height:1.3em;line-height:1.3em;font-weight:800;position:absolute;width:100%;left:0;transition:transform .45s cubic-bezier(.4,0,.2,1),opacity .45s cubic-bezier(.4,0,.2,1)}
.word-rotator .word.worse{color:#dc2626}
.word-rotator .word.better{color:#059669}
.word-rotator .word.state-visible{transform:translateY(0);opacity:1}
.word-rotator .word.state-exit{transform:translateY(110%);opacity:0}
.word-rotator .word.state-above{transform:translateY(-110%);opacity:0;transition:none}
.baseline-name{color:#4f46e5;font-weight:800;font-style:italic}

.controls{display:flex;align-items:center;gap:12px;margin-bottom:20px;flex-wrap:wrap}
.mode-btn{padding:6px 16px;border:1.5px solid #ddd;border-radius:7px;font-size:13px;font-weight:500;font-family:inherit;background:#fff;color:#333;cursor:pointer;transition:all .12s}
.mode-btn:hover{border-color:#aaa;background:#f7f7f7}
.mode-btn.active{border-color:#4f46e5;background:#4f46e5;color:#fff;box-shadow:0 2px 8px rgba(79,70,229,.2)}
.controls select{padding:6px 12px;border:1px solid #ddd;border-radius:6px;font-size:13px;font-family:inherit;background:#fafafa;transition:border-color .15s}
.controls select:focus{outline:none;border-color:#4f46e5}
.controls label{font-size:13px;font-weight:600;color:#555}

.chart-wrap{position:relative;height:460px}
.range-badge{position:absolute;top:8px;right:8px;background:#4f46e5;color:#fff;font-size:11px;font-weight:600;padding:4px 10px;border-radius:4px;z-index:11;opacity:0;transform:translateY(-8px);transition:opacity .25s,transform .25s;pointer-events:none;font-family:'JetBrains Mono',monospace}
.range-badge.visible{opacity:1;transform:translateY(0)}

@media(max-width:640px){
    .container{padding:20px}
    .chart-wrap{height:320px}
}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="title-abs hidden" id="titleAbs">
            <h2>Recall@K</h2>
            <p class="subtitle">Higher is better. Evaluated on ZeroEntropy internal benchmarks.</p>
        </div>
        <div class="title-delta" id="titleDelta">
            <div class="delta-title">
                Which models are
                <span class="word-rotator" id="wordRotator">
                    <span class="word worse state-visible" id="wordA">worse</span>
                    <span class="word better state-above" id="wordB">better</span>
                </span>
                than <span class="baseline-name" id="baselineLabel"></span>?
            </div>
            <p class="subtitle">&Delta; Recall@K vs baseline. Above zero is better.</p>
        </div>
    </div>
    <div class="controls">
        <button class="mode-btn" id="btnAbs" onclick="setMode('absolute')">Absolute</button>
        <button class="mode-btn active" id="btnDelta" onclick="setMode('delta')">Relative</button>
        <div id="baselineControl">
            <label>vs</label>
            <select id="baselineSelect" onchange="onBaselineChange()"></select>
        </div>
    </div>
    <div class="chart-wrap">
        <canvas id="recallChart"></canvas>
        <div class="range-badge" id="rangeBadge"></div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script>
const RAW = {"labels": ["1", "5", "10", "20", "50", "100"], "datasets": [{"label": "Qwen3-Embedding-4B", "data": [0.06697, 0.20305, 0.29925, 0.41151, 0.56253, 0.66905], "hideAbsolute": false, "fullData": [0.06697, 0.11129, 0.14799, 0.17646, 0.20305, 0.22831, 0.24787, 0.26657, 0.28279, 0.29925, 0.31376, 0.32637, 0.3415, 0.3525, 0.36181, 0.37328, 0.38237, 0.39178, 0.4015, 0.41151, 0.42066, 0.42989, 0.43723, 0.44346, 0.45049, 0.45665, 0.46291, 0.46925, 0.47622, 0.48193, 0.48752, 0.49262, 0.49707, 0.50217, 0.50684, 0.51101, 0.51518, 0.51921, 0.52242, 0.52725, 0.53152, 0.53472, 0.53894, 0.54186, 0.54579, 0.54988, 0.55346, 0.55664, 0.55957, 0.56253, 0.56477, 0.56747, 0.56996, 0.57266, 0.57656, 0.58017, 0.58288, 0.58551, 0.58759, 0.5919, 0.59494, 0.59732, 0.60033, 0.60295, 0.60536, 0.60728, 0.61117, 0.61281, 0.61509, 0.61731, 0.61888, 0.62155, 0.62345, 0.62574, 0.62758, 0.62937, 0.63098, 0.63314, 0.63509, 0.63658, 0.63864, 0.64059, 0.64156, 0.64303, 0.64483, 0.64623, 0.64837, 0.65076, 0.65299, 0.65457, 0.65598, 0.65746, 0.65863, 0.65988, 0.66149, 0.66341, 0.66475, 0.66636, 0.66775, 0.66905], "borderColor": "#ff7d59", "backgroundColor": "#ff7d5918", "borderWidth": 2, "pointRadius": 4, "pointHoverRadius": 6, "tension": 0.35, "fill": false}, {"label": "zembed-1", "data": [0.07477, 0.22212, 0.32857, 0.44242, 0.60557, 0.71352], "hideAbsolute": false, "fullData": [0.07477, 0.12281, 0.16117, 0.19314, 0.22212, 0.25068, 0.27218, 0.29181, 0.31019, 0.32857, 0.3435, 0.357, 0.36872, 0.38159, 0.39366, 0.40414, 0.41443, 0.42296, 0.43162, 0.44242, 0.45176, 0.46027, 0.46677, 0.47485, 0.48235, 0.49033, 0.49713, 0.50342, 0.50982, 0.51477, 0.52252, 0.52809, 0.53396, 0.53957, 0.54496, 0.5498, 0.55554, 0.56078, 0.56453, 0.56877, 0.57306, 0.57714, 0.58068, 0.58475, 0.59015, 0.59438, 0.59688, 0.60016, 0.60251, 0.60557, 0.60927, 0.61331, 0.61657, 0.6192, 0.62168, 0.62421, 0.62646, 0.62945, 0.63289, 0.63539, 0.63935, 0.64145, 0.64351, 0.64569, 0.64754, 0.65044, 0.65271, 0.65415, 0.65643, 0.65963, 0.66179, 0.66333, 0.66581, 0.66768, 0.66976, 0.67204, 0.6737, 0.6759, 0.67758, 0.67933, 0.68111, 0.68328, 0.68485, 0.68671, 0.68814, 0.69023, 0.69181, 0.69372, 0.69475, 0.69668, 0.69911, 0.70155, 0.70372, 0.70513, 0.707, 0.70818, 0.70947, 0.71096, 0.71245, 0.71352], "borderColor": "#4f46e5", "backgroundColor": "#4f46e518", "borderWidth": 2, "pointRadius": 4, "pointHoverRadius": 6, "tension": 0.35, "fill": false}, {"label": "Voyage 4", "data": [0.06552, 0.20847, 0.31541, 0.42886, 0.59533, 0.70976], "hideAbsolute": true, "fullData": [0.06552, 0.11047, 0.14713, 0.18214, 0.20847, 0.23352, 0.25545, 0.2778, 0.29755, 0.31541, 0.32955, 0.34344, 0.35488, 0.36702, 0.37848, 0.39, 0.40018, 0.40934, 0.41965, 0.42886, 0.43897, 0.44618, 0.45463, 0.46125, 0.46798, 0.47533, 0.48293, 0.48993, 0.49608, 0.50216, 0.50766, 0.51377, 0.52007, 0.52517, 0.53137, 0.53619, 0.54022, 0.54494, 0.54906, 0.5528, 0.55736, 0.5612, 0.56616, 0.5701, 0.57319, 0.57766, 0.58194, 0.58574, 0.59177, 0.59533, 0.59867, 0.60195, 0.60465, 0.60751, 0.61154, 0.61501, 0.61792, 0.62049, 0.62411, 0.6268, 0.6292, 0.63243, 0.63432, 0.6368, 0.63982, 0.64254, 0.64516, 0.64723, 0.64925, 0.65141, 0.65371, 0.656, 0.65809, 0.65968, 0.66295, 0.66578, 0.66791, 0.66902, 0.67123, 0.67341, 0.67512, 0.67726, 0.68011, 0.68163, 0.68394, 0.68651, 0.68814, 0.69062, 0.69271, 0.69406, 0.69685, 0.69851, 0.69988, 0.70073, 0.7023, 0.70358, 0.70509, 0.70688, 0.7086, 0.70976], "borderColor": "#f59e0b", "backgroundColor": "#f59e0b18", "borderWidth": 2, "pointRadius": 4, "pointHoverRadius": 6, "tension": 0.35, "fill": false}, {"label": "Voyage 4 Nano", "data": [0.05638, 0.18599, 0.27791, 0.38854, 0.54611, 0.65975], "hideAbsolute": false, "fullData": [0.05638, 0.09675, 0.13112, 0.16021, 0.18599, 0.20369, 0.22397, 0.24121, 0.26075, 0.27791, 0.29193, 0.30417, 0.31532, 0.32813, 0.33751, 0.34837, 0.35963, 0.3692, 0.38091, 0.38854, 0.39687, 0.40569, 0.41239, 0.41897, 0.42692, 0.43429, 0.44101, 0.44728, 0.45281, 0.45875, 0.46393, 0.46922, 0.47464, 0.47979, 0.48357, 0.48772, 0.49389, 0.498, 0.50268, 0.50669, 0.51034, 0.51408, 0.51922, 0.52304, 0.52699, 0.53137, 0.53465, 0.53838, 0.54269, 0.54611, 0.5487, 0.55218, 0.55426, 0.55698, 0.55997, 0.56265, 0.5655, 0.56886, 0.57079, 0.57336, 0.5768, 0.57969, 0.58215, 0.58493, 0.58872, 0.59067, 0.59376, 0.59665, 0.59907, 0.60187, 0.60401, 0.60618, 0.60878, 0.61073, 0.61288, 0.615, 0.61718, 0.62007, 0.62258, 0.62486, 0.62695, 0.62867, 0.63128, 0.63338, 0.63581, 0.63738, 0.63931, 0.64115, 0.64202, 0.64346, 0.64533, 0.64695, 0.64859, 0.65007, 0.65156, 0.65318, 0.65467, 0.6567, 0.65802, 0.65975], "borderColor": "#fbbf24", "backgroundColor": "#fbbf2418", "borderWidth": 2, "pointRadius": 4, "pointHoverRadius": 6, "tension": 0.35, "fill": false}, {"label": "OpenAI text-embedding-3-large", "data": [0.05532, 0.1812, 0.27221, 0.38108, 0.5378, 0.64892], "hideAbsolute": false, "fullData": [0.05532, 0.09518, 0.129, 0.15517, 0.1812, 0.20393, 0.22331, 0.24021, 0.25679, 0.27221, 0.2849, 0.29719, 0.31016, 0.32124, 0.33188, 0.34084, 0.35038, 0.36152, 0.37167, 0.38108, 0.38965, 0.39687, 0.40391, 0.41159, 0.41788, 0.42556, 0.432, 0.43706, 0.44259, 0.44823, 0.45396, 0.46013, 0.46462, 0.47109, 0.47491, 0.48086, 0.48476, 0.48911, 0.49337, 0.49779, 0.50228, 0.50722, 0.51235, 0.5163, 0.5192, 0.52309, 0.52665, 0.53082, 0.53506, 0.5378, 0.54171, 0.54441, 0.54807, 0.55063, 0.55318, 0.55619, 0.5592, 0.56154, 0.56499, 0.5676, 0.57099, 0.57377, 0.57674, 0.57922, 0.58205, 0.58475, 0.58774, 0.5903, 0.59217, 0.59511, 0.59705, 0.5992, 0.60046, 0.60352, 0.60581, 0.6074, 0.60917, 0.61086, 0.61327, 0.61494, 0.61659, 0.61822, 0.62041, 0.62221, 0.62411, 0.62659, 0.62851, 0.63038, 0.63262, 0.63453, 0.63577, 0.63698, 0.6384, 0.64056, 0.64211, 0.64338, 0.64418, 0.64555, 0.64762, 0.64892], "borderColor": "#10a37f", "backgroundColor": "#10a37f18", "borderWidth": 2, "pointRadius": 4, "pointHoverRadius": 6, "tension": 0.35, "fill": false}, {"label": "OpenAI text-embedding-3-small", "data": [0.05151, 0.15794, 0.23862, 0.33895, 0.48477, 0.59779], "hideAbsolute": false, "fullData": [0.05151, 0.08477, 0.11496, 0.13818, 0.15794, 0.17541, 0.19028, 0.2078, 0.22551, 0.23862, 0.25051, 0.26262, 0.27486, 0.28456, 0.29497, 0.30403, 0.31223, 0.32165, 0.33063, 0.33895, 0.34642, 0.35292, 0.36058, 0.36648, 0.37338, 0.3785, 0.38443, 0.38978, 0.39519, 0.40102, 0.40625, 0.4118, 0.41791, 0.42192, 0.4269, 0.43143, 0.43509, 0.44027, 0.44571, 0.44948, 0.4536, 0.45679, 0.46053, 0.46442, 0.46803, 0.47084, 0.47447, 0.47794, 0.48129, 0.48477, 0.48774, 0.49114, 0.49541, 0.49827, 0.50135, 0.50404, 0.50718, 0.50942, 0.51144, 0.51341, 0.51588, 0.51775, 0.51942, 0.52245, 0.52522, 0.52687, 0.52903, 0.53198, 0.53416, 0.5364, 0.53918, 0.54167, 0.54366, 0.54623, 0.54847, 0.5503, 0.55218, 0.55402, 0.5554, 0.55704, 0.55932, 0.56151, 0.56352, 0.56528, 0.56747, 0.56988, 0.57274, 0.57414, 0.57644, 0.57815, 0.57944, 0.58158, 0.5836, 0.58476, 0.58689, 0.58874, 0.59046, 0.59338, 0.59558, 0.59779], "borderColor": "#6ee7b7", "backgroundColor": "#6ee7b718", "borderWidth": 2, "pointRadius": 4, "pointHoverRadius": 6, "tension": 0.35, "fill": false}]};
const BASELINE_IDX = 1;
const orig = RAW.datasets.map(d => ({...d, data:[...d.data]}));

let mode = 'delta';
let chart;
let rotatorTimer = null;
let rotatorWord = 0;
let prevYMin = null, prevYMax = null;

function initSelect() {
    const sel = document.getElementById('baselineSelect');
    orig.forEach((d,i) => {
        const opt = document.createElement('option');
        opt.value = i; opt.textContent = d.label;
        if (i === BASELINE_IDX) opt.selected = true;
        sel.appendChild(opt);
    });
}

/* ── Rotator (visibility-aware) ── */
function snapRotator() {
    const wA = document.getElementById('wordA');
    const wB = document.getElementById('wordB');
    if (rotatorWord === 0) {
        wA.className = 'word worse state-visible';
        wB.className = 'word better state-above';
    } else {
        wB.className = 'word better state-visible';
        wA.className = 'word worse state-above';
    }
}

function stepRotator() {
    const wA = document.getElementById('wordA');
    const wB = document.getElementById('wordB');
    if (rotatorWord === 0) {
        wA.className = 'word worse state-exit';
        wB.className = 'word better state-above';
        requestAnimationFrame(() => requestAnimationFrame(() => {
            wB.className = 'word better state-visible';
        }));
        rotatorWord = 1;
    } else {
        wB.className = 'word better state-exit';
        wA.className = 'word worse state-above';
        requestAnimationFrame(() => requestAnimationFrame(() => {
            wA.className = 'word worse state-visible';
        }));
        rotatorWord = 0;
    }
}

function startRotator() {
    stopRotator();
    rotatorWord = 0;
    snapRotator();
    rotatorTimer = setInterval(stepRotator, 2200);
}

function stopRotator() {
    if (rotatorTimer) { clearInterval(rotatorTimer); rotatorTimer = null; }
}

document.addEventListener('visibilitychange', () => {
    if (mode !== 'delta') return;
    if (document.hidden) {
        stopRotator();
    } else {
        snapRotator();
        rotatorTimer = setInterval(stepRotator, 2200);
    }
});

/* ── Y-range badge ── */
function flashRange(yMin, yMax) {
    const badge = document.getElementById('rangeBadge');
    const fmt = v => (v >= 0 ? '+' : '') + v.toFixed(3);
    badge.textContent = 'y: [' + yMin.toFixed(3) + ', ' + yMax.toFixed(3) + ']';
    badge.classList.add('visible');
    setTimeout(() => badge.classList.remove('visible'), 1800);
}

/* ── Compute y-range with padding ── */
function computeRange(datasets) {
    let lo = Infinity, hi = -Infinity;
    for (const ds of datasets) {
        if (ds.hidden) continue;
        for (const v of ds.data) {
            if (v < lo) lo = v;
            if (v > hi) hi = v;
        }
    }
    const range = hi - lo || 0.01;
    const pad = range * 0.08;
    return [Math.floor((lo - pad) * 1000) / 1000, Math.ceil((hi + pad) * 1000) / 1000];
}

/* ── Mode switching ── */
function setMode(m) {
    mode = m;
    document.getElementById('btnAbs').classList.toggle('active', m === 'absolute');
    document.getElementById('btnDelta').classList.toggle('active', m === 'delta');
    document.getElementById('baselineControl').style.display = m === 'delta' ? '' : 'none';
    document.getElementById('titleAbs').classList.toggle('hidden', m !== 'absolute');
    document.getElementById('titleDelta').classList.toggle('hidden', m !== 'delta');
    if (m === 'delta') startRotator(); else stopRotator();
    updateChart();
}

function onBaselineChange() { updateChart(); }

function updateChart() {
    const baseIdx = parseInt(document.getElementById('baselineSelect').value);
    const baseData = orig[baseIdx].data;
    document.getElementById('baselineLabel').textContent = orig[baseIdx].label;

    if (mode === 'delta') {
        chart.data.datasets.forEach((ds, i) => {
            ds.data = orig[i].data.map((v, k) => Math.round((v - baseData[k]) * 100000) / 100000);
            ds.hidden = false;
            if (i === baseIdx) {
                ds.borderWidth = 2.5; ds.borderDash = [6, 4];
            } else {
                ds.borderWidth = 2; ds.borderDash = [];
            }
            ds.borderColor = orig[i].borderColor;
            ds.fill = false;
        });
        chart.options.scales.y.title.text = '\u0394 Recall@K';
    } else {
        chart.data.datasets.forEach((ds, i) => {
            ds.data = [...orig[i].data];
            ds.hidden = !!orig[i].hideAbsolute;
            ds.borderWidth = 2; ds.borderDash = [];
            ds.borderColor = orig[i].borderColor;
            ds.fill = false;
        });
        chart.options.scales.y.title.text = 'Recall@K';
    }

    const [newMin, newMax] = computeRange(chart.data.datasets);
    if (prevYMin !== null && (Math.abs(newMin - prevYMin) > 0.001 || Math.abs(newMax - prevYMax) > 0.001)) {
        flashRange(newMin, newMax);
    }
    chart.options.scales.y.min = newMin;
    chart.options.scales.y.max = newMax;
    prevYMin = newMin;
    prevYMax = newMax;

    chart.update();
}

/* ── Init ── */
initSelect();

chart = new Chart(document.getElementById('recallChart').getContext('2d'), {
    type: 'line',
    data: JSON.parse(JSON.stringify(RAW)),
    options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: { duration: 500, easing: 'easeInOutCubic' },
        transitions: { active: { animation: { duration: 200 } } },
        interaction: { mode: 'index', intersect: false },
        plugins: {
            legend: {
                position: 'bottom',
                labels: { usePointStyle: true, pointStyle: 'circle', padding: 20, font: { size: 12, family: 'Inter' } },
            },
            tooltip: {
                itemSort: (a, b) => b.parsed.y - a.parsed.y,
                callbacks: {
                    title: items => 'K = ' + items[0].label,
                    label: item => {
                        const pre = mode === 'delta' ? (item.parsed.y >= 0 ? '+' : '') : '';
                        return item.dataset.label + ': ' + pre + item.parsed.y.toFixed(4);
                    },
                },
            },
        },
        scales: {
            x: {
                title: { display: true, text: 'K', font: { size: 12, family: 'Inter' } },
                grid: { color: '#f0f0f0' },
            },
            y: {
                title: { display: true, text: '\u0394 Recall@K', font: { size: 12, family: 'Inter' } },
                grid: { color: '#f0f0f0' },
                min: 0, max: 1,
            },
        },
    },
});

setMode('delta');
</script>
</body>
</html>